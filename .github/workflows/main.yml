jobs:
  build:
    name: Build Image
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Grant execute permission for Gradlew
      run: chmod +x ./gradlew

    - name: Build JAR with Gradle
      run: ./gradlew bootJar

    - name: Login to Amazon ECR
      uses: aws-actions/amazon-ecr-login@v1

    - name: Build, tag, and push image to Amazon ECR
      run: |
        docker build -t infra_study .
        docker tag infra_study:latest 905418222682.dkr.ecr.ap-northeast-2.amazonaws.com/infra_study:latest
        docker push 905418222682.dkr.ecr.ap-northeast-2.amazonaws.com/infra_study:latest
